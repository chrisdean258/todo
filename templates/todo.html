
<HTML>
  <head>
    <title>Todo</title>
    <style>
      .todo-container{
        position: relative;
        left: 30px;
      }
      .todo-add{
        position: relative;
        left: 15px;
      }
      button {
        background-color: #555555;
        border: none;
        color: white;
        /*padding: 15px 32px;*/
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
      }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>

function togglecontainer(node, just_show=false) {
  containernode = node.children("#" + node.attr("id") + "-container");
  if (containernode.css("display") == "none" || just_show)
    containernode.css("display", "block");
  else
    containernode.css("display", "none");
}

function toggleaddform(node) {
  formnode = node.find("#" + node.attr("id") + "-form");
  if (formnode.css("display") == "none") {
    formnode.css("display", "block");
    togglecontainer(node, true);
  }
  else
    formnode.css("display", "none");
}


function render_todos(todo, pnode) {
  var todonode = pnode.find("#" + pnode.attr("id") + "-list");
  var newnode = $("<div>").attr("id", todo.id)

  var delbtn = $("<button>").attr("id", todo.id + "-delete").addClass("delete-button").html("&times;")
    .click(function() { del(newnode); });
  var addbtn = $("<button>").attr("id", todo.id + "-add").addClass("add-button").html("&plus;")
    .click(function() { toggleaddform(newnode); });
  var expandbtn = $("<button>").attr("id", todo.id + "-toggle").addClass("toggle-button").html("&equiv;")
    .click(function() { togglecontainer(newnode) });
  newnode.append(delbtn).append(addbtn).append(expandbtn);

  newnode.append($("<div>").attr("id", todo.id + "-title").css("display", "inline").addClass("todo-title").text(todo.title));
  var container = $("<div>").attr("id", todo.id + "-container").addClass("todo-container");
  newnode.append(container);
  container.append($("<div>").attr("id", todo.id + "-list").addClass("todo-list"));
  formdiv = $("<div>").attr("id", todo.id + "-form").addClass("todo-form").css("display", "none").text("test");
  container.append(formdiv);
  todonode.append(newnode);


  for(var child_todo of todo.todos) 
    render_todos(child_todo, newnode);
}

window.onload = function() {
  var todos = JSON.parse('{{data.todos|tojson}}');
  var pnode = $("#todos")
  for(var todo of todos)
    render_todos(todo, pnode);
  //append_element(pnode);
}
    </script>
  </head>
  <body>
    <h1>Todo for {{data.username}}</h1>
    <div id="todos">
      <div id="todos-container" class="todo-container">
        <div id="todos-list" class="todo-list"></div>
        <div id="todos-form" class="todo-form"></div>
      </div>
    </div>
  </body>
</HTML>

